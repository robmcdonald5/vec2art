<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vec2art WASM Demo - Line Tracing Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .demo-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .controls-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-input-container {
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .file-input-label:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .preset-button {
            padding: 12px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }

        .preset-button:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .preset-button.active {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .control-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .control-group h4 {
            margin-bottom: 12px;
            color: #495057;
            font-size: 1em;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        label {
            font-size: 0.9em;
            color: #6c757d;
            flex: 1;
        }

        input[type="range"] {
            flex: 2;
            margin: 0 10px;
        }

        input[type="checkbox"] {
            margin-right: 5px;
        }

        select {
            flex: 1;
            padding: 5px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }

        .value-display {
            min-width: 40px;
            text-align: right;
            font-family: monospace;
            font-size: 0.9em;
        }

        .process-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .process-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .process-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .result-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .image-container, .svg-container {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background: white;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: auto;
        }

        .placeholder {
            color: #6c757d;
            font-style: italic;
            text-align: center;
        }

        .result-image, .result-svg {
            max-width: 100%;
            max-height: 400px;
            border-radius: 4px;
        }

        .stats-container {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: 600;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-button {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .action-button:hover {
            background: #007bff;
            color: white;
        }

        .config-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .config-export {
            background: #495057;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .config-display {
            background: #212529;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 200px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 15px 0;
            display: none;
        }

        .feature-support {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .feature-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .feature-supported {
            background: #28a745;
        }

        .feature-unsupported {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .results-section {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .presets-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 vec2art WASM Demo</h1>
            <p>High-performance line tracing engine - Convert images to expressive SVG line art in &lt;1.5s</p>
        </div>

        <div class="demo-container">
            <!-- Feature Support Status -->
            <div class="feature-support">
                <div class="feature-item">
                    <div class="feature-status" id="wasmSupport"></div>
                    <span>WebAssembly</span>
                </div>
                <div class="feature-item">
                    <div class="feature-status" id="simdSupport"></div>
                    <span>SIMD</span>
                </div>
                <div class="feature-item">
                    <div class="feature-status" id="workerSupport"></div>
                    <span>Web Workers</span>
                </div>
            </div>

            <!-- File Input Section -->
            <div class="controls-section">
                <div class="section-title">
                    📁 Image Input
                </div>
                <div class="file-input-container">
                    <input type="file" id="imageInput" class="file-input" accept="image/*">
                    <label for="imageInput" class="file-input-label">
                        Choose Image File
                    </label>
                    <span id="fileName" style="margin-left: 15px; color: #6c757d;"></span>
                </div>
            </div>

            <!-- Preset Section -->
            <div class="controls-section">
                <div class="section-title">
                    ⚡ Quick Presets
                </div>
                <div class="presets-grid">
                    <button class="preset-button active" data-preset="clean">
                        <strong>Clean</strong><br>
                        <small>Technical drawings</small>
                    </button>
                    <button class="preset-button" data-preset="sketchy">
                        <strong>Sketchy</strong><br>
                        <small>Light hand-drawn feel</small>
                    </button>
                    <button class="preset-button" data-preset="artistic">
                        <strong>Artistic</strong><br>
                        <small>Balanced enhancement</small>
                    </button>
                    <button class="preset-button" data-preset="expressive">
                        <strong>Expressive</strong><br>
                        <small>Maximum artistic effect</small>
                    </button>
                </div>
            </div>

            <!-- Advanced Controls -->
            <div class="controls-section">
                <div class="section-title">
                    🔧 Advanced Configuration
                </div>
                <div class="controls-grid">
                    <!-- Backend Selection -->
                    <div class="control-group">
                        <h4>Algorithm Backend</h4>
                        <div class="control-row">
                            <label>Backend:</label>
                            <select id="backendSelect">
                                <option value="edge">Edge Detection</option>
                                <option value="centerline">Centerline Tracing</option>
                                <option value="superpixel">Superpixel Regions</option>
                                <option value="dots">Dot Mapping</option>
                            </select>
                        </div>
                    </div>

                    <!-- Multi-pass Processing -->
                    <div class="control-group">
                        <h4>Multi-pass Processing</h4>
                        <div class="control-row">
                            <label><input type="checkbox" id="multipassEnabled" checked> Enable Multi-pass</label>
                        </div>
                        <div class="control-row">
                            <label><input type="checkbox" id="reversePassEnabled" checked> Reverse Pass</label>
                        </div>
                        <div class="control-row">
                            <label><input type="checkbox" id="diagonalPassEnabled"> Diagonal Pass</label>
                        </div>
                    </div>

                    <!-- Hand-drawn Aesthetics -->
                    <div class="control-group">
                        <h4>Hand-drawn Effects</h4>
                        <div class="control-row">
                            <label><input type="checkbox" id="handDrawnEnabled" checked> Enable Effects</label>
                        </div>
                        <div class="control-row">
                            <label>Tremor:</label>
                            <input type="range" id="tremorIntensity" min="0" max="1" step="0.1" value="0.3">
                            <span class="value-display" id="tremorValue">0.3</span>
                        </div>
                        <div class="control-row">
                            <label>Weight Variation:</label>
                            <input type="range" id="weightVariation" min="0" max="1" step="0.1" value="0.4">
                            <span class="value-display" id="weightValue">0.4</span>
                        </div>
                        <div class="control-row">
                            <label><input type="checkbox" id="taperingEnabled" checked> Tapering</label>
                        </div>
                    </div>

                    <!-- Edge Detection Parameters -->
                    <div class="control-group">
                        <h4>Edge Detection</h4>
                        <div class="control-row">
                            <label>Low Threshold:</label>
                            <input type="range" id="cannyLowThreshold" min="0.05" max="0.3" step="0.05" value="0.1">
                            <span class="value-display" id="lowThresholdValue">0.1</span>
                        </div>
                        <div class="control-row">
                            <label>High Threshold:</label>
                            <input type="range" id="cannyHighThreshold" min="0.2" max="0.5" step="0.05" value="0.3">
                            <span class="value-display" id="highThresholdValue">0.3</span>
                        </div>
                        <div class="control-row">
                            <label>Blur Sigma:</label>
                            <input type="range" id="gaussianBlurSigma" min="0.5" max="3.0" step="0.1" value="1.2">
                            <span class="value-display" id="blurValue">1.2</span>
                        </div>
                    </div>

                    <!-- Performance Settings -->
                    <div class="control-group">
                        <h4>Performance</h4>
                        <div class="control-row">
                            <label>Max Resolution:</label>
                            <select id="maxResolution">
                                <option value="1920000">1920×1000</option>
                                <option value="2073600" selected>1920×1080</option>
                                <option value="3686400">2560×1440</option>
                                <option value="8294400">3840×2160 (4K)</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <label><input type="checkbox" id="simdEnabled" checked> SIMD Acceleration</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Process Button -->
            <button id="processButton" class="process-button">
                🚀 Process Image to SVG
            </button>

            <!-- Progress Indicator -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Processing...</div>
            </div>

            <!-- Error Display -->
            <div class="error-message" id="errorMessage"></div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection" style="display: none;">
                <!-- Original Image -->
                <div class="result-panel">
                    <div class="section-title">📷 Original Image</div>
                    <div class="image-container">
                        <div class="placeholder" id="imagePlaceholder">
                            No image loaded
                        </div>
                        <img id="originalImage" class="result-image" style="display: none;">
                    </div>
                    <div class="action-buttons">
                        <button class="action-button" onclick="resetDemo()">Reset</button>
                        <button class="action-button" onclick="loadSampleImage()">Load Sample</button>
                    </div>
                </div>

                <!-- Generated SVG -->
                <div class="result-panel">
                    <div class="section-title">🎨 Generated SVG</div>
                    <div class="svg-container" id="svgContainer">
                        <div class="placeholder">
                            SVG will appear here after processing
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-button" onclick="downloadSVG()">Download SVG</button>
                        <button class="action-button" onclick="viewSVGSource()">View Source</button>
                    </div>
                </div>
            </div>

            <!-- Statistics Display -->
            <div class="stats-container" id="statsContainer" style="display: none;">
                <div class="section-title">📊 Processing Statistics</div>
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats populated by JavaScript -->
                </div>
            </div>

            <!-- Configuration Export -->
            <div class="config-section">
                <div class="section-title">⚙️ Configuration Export</div>
                <button class="config-export" onclick="exportConfiguration()">
                    Export Current Config
                </button>
                <div class="config-display" id="configDisplay">
                    // Configuration will appear here
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import WASM module (adjust path as needed)
        // import * as wasm from '../pkg/vectorize_wasm.js';
        
        // For demonstration, we'll create mock WASM functions
        // Replace this with actual WASM import when available
        const wasm = {
            ConfigBuilder: class {
                constructor() {
                    this.config = {
                        backend: 'edge',
                        multipass_enabled: true,
                        reverse_pass_enabled: true,
                        diagonal_pass_enabled: false,
                        hand_drawn_enabled: true,
                        tremor_intensity: 0.3,
                        weight_variation: 0.4,
                        tapering_enabled: true,
                        canny_low_threshold: 0.1,
                        canny_high_threshold: 0.3,
                        gaussian_blur_sigma: 1.2,
                        max_resolution: 2073600,
                        simd_enabled: true
                    };
                }
                
                backend(name) { this.config.backend = name; return this; }
                multipass_enabled(enabled) { this.config.multipass_enabled = enabled; return this; }
                reverse_pass_enabled(enabled) { this.config.reverse_pass_enabled = enabled; return this; }
                diagonal_pass_enabled(enabled) { this.config.diagonal_pass_enabled = enabled; return this; }
                hand_drawn_enabled(enabled) { this.config.hand_drawn_enabled = enabled; return this; }
                tremor_intensity(value) { this.config.tremor_intensity = value; return this; }
                weight_variation(value) { this.config.weight_variation = value; return this; }
                tapering_enabled(enabled) { this.config.tapering_enabled = enabled; return this; }
                canny_low_threshold(value) { this.config.canny_low_threshold = value; return this; }
                canny_high_threshold(value) { this.config.canny_high_threshold = value; return this; }
                gaussian_blur_sigma(value) { this.config.gaussian_blur_sigma = value; return this; }
                max_resolution(pixels) { this.config.max_resolution = pixels; return this; }
                simd_enabled(enabled) { this.config.simd_enabled = enabled; return this; }
                artistic_preset(preset) { 
                    this.applyPreset(preset);
                    return this;
                }
                
                applyPreset(preset) {
                    switch(preset) {
                        case 'clean':
                            this.config.hand_drawn_enabled = false;
                            this.config.tremor_intensity = 0.0;
                            this.config.weight_variation = 0.1;
                            break;
                        case 'sketchy':
                            this.config.hand_drawn_enabled = true;
                            this.config.tremor_intensity = 0.2;
                            this.config.weight_variation = 0.3;
                            break;
                        case 'artistic':
                            this.config.hand_drawn_enabled = true;
                            this.config.tremor_intensity = 0.4;
                            this.config.weight_variation = 0.5;
                            break;
                        case 'expressive':
                            this.config.hand_drawn_enabled = true;
                            this.config.tremor_intensity = 0.6;
                            this.config.weight_variation = 0.7;
                            break;
                    }
                }
                
                build() { return this.config; }
            },
            
            process_image_to_svg: async function(imageData, width, height, config) {
                // Mock processing delay
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                
                // Generate mock SVG
                return `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10,10 L${width-10},${height-10} M${width-10},10 L10,${height-10}" 
                          stroke="black" stroke-width="2" fill="none"/>
                    <text x="${width/2}" y="${height/2}" text-anchor="middle" font-family="Arial" font-size="20">
                        Mock SVG Output
                    </text>
                    <text x="${width/2}" y="${height/2 + 30}" text-anchor="middle" font-family="Arial" font-size="14">
                        Backend: ${config.backend}
                    </text>
                </svg>`;
            },
            
            get_last_processing_stats: function() {
                return {
                    processing_time_ms: 800 + Math.random() * 700,
                    input_resolution: `${currentImageWidth}×${currentImageHeight}`,
                    output_paths: 150 + Math.floor(Math.random() * 300),
                    multipass_enabled: currentConfig.multipass_enabled,
                    hand_drawn_enabled: currentConfig.hand_drawn_enabled,
                    backend_used: currentConfig.backend
                };
            }
        };

        // Global variables
        let currentImage = null;
        let currentImageData = null;
        let currentImageWidth = 0;
        let currentImageHeight = 0;
        let currentConfig = null;
        let currentSVG = null;

        // Feature detection
        function checkFeatureSupport() {
            // WebAssembly support
            const wasmSupported = (() => {
                try {
                    if (typeof WebAssembly === "object" &&
                        typeof WebAssembly.instantiate === "function") {
                        const module = new WebAssembly.Module(
                            new Uint8Array([0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00])
                        );
                        return module instanceof WebAssembly.Module;
                    }
                } catch (e) {}
                return false;
            })();

            // SIMD support
            const simdSupported = (() => {
                try {
                    return WebAssembly.validate(new Uint8Array([
                        0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00,
                        0x01, 0x05, 0x01, 0x60, 0x01, 0x7b, 0x00,
                        0x03, 0x02, 0x01, 0x00,
                        0x0a, 0x0a, 0x01, 0x08, 0x00, 0x20, 0x00, 0x1a, 0x0b
                    ]));
                } catch (e) {
                    return false;
                }
            })();

            // Web Workers support
            const workerSupported = typeof Worker !== 'undefined';

            // Update UI
            document.getElementById('wasmSupport').className = 
                `feature-status feature-${wasmSupported ? 'supported' : 'unsupported'}`;
            document.getElementById('simdSupport').className = 
                `feature-status feature-${simdSupported ? 'supported' : 'unsupported'}`;
            document.getElementById('workerSupport').className = 
                `feature-status feature-${workerSupported ? 'supported' : 'unsupported'}`;

            // Disable SIMD if not supported
            if (!simdSupported) {
                document.getElementById('simdEnabled').checked = false;
                document.getElementById('simdEnabled').disabled = true;
            }
        }

        // Initialize UI
        function initializeUI() {
            // Check feature support
            checkFeatureSupport();

            // Set up event listeners
            document.getElementById('imageInput').addEventListener('change', handleImageSelection);
            document.getElementById('processButton').addEventListener('click', processImage);

            // Set up preset buttons
            document.querySelectorAll('.preset-button').forEach(button => {
                button.addEventListener('click', () => applyPreset(button.dataset.preset));
            });

            // Set up range inputs with value display
            const rangeInputs = [
                'tremorIntensity', 'weightVariation', 'cannyLowThreshold', 
                'cannyHighThreshold', 'gaussianBlurSigma'
            ];
            
            rangeInputs.forEach(id => {
                const input = document.getElementById(id);
                const display = document.getElementById(id.replace('tremor', 'tremor').replace('weight', 'weight').replace('canny', '').replace('Low', 'low').replace('High', 'high').replace('Threshold', 'ThresholdValue').replace('gaussian', '').replace('Blur', '').replace('Sigma', 'Value') || id + 'Value');
                
                if (input && display) {
                    input.addEventListener('input', () => {
                        display.textContent = input.value;
                        updateConfiguration();
                    });
                }
            });

            // Set up other controls
            document.getElementById('backendSelect').addEventListener('change', updateConfiguration);
            document.querySelectorAll('input[type="checkbox"]').forEach(input => {
                input.addEventListener('change', updateConfiguration);
            });
            document.getElementById('maxResolution').addEventListener('change', updateConfiguration);

            // Initialize configuration display
            updateConfiguration();
        }

        // Handle image selection
        function handleImageSelection(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('fileName').textContent = file.name;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    currentImageWidth = img.width;
                    currentImageHeight = img.height;

                    // Display original image
                    const originalImage = document.getElementById('originalImage');
                    originalImage.src = e.target.result;
                    originalImage.style.display = 'block';
                    document.getElementById('imagePlaceholder').style.display = 'none';

                    // Show results section
                    document.getElementById('resultsSection').style.display = 'grid';

                    // Extract image data
                    extractImageData(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Extract image data for processing
        function extractImageData(img) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            
            ctx.drawImage(img, 0, 0);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            currentImageData = new Uint8Array(imageData.data.buffer);
        }

        // Apply preset configuration
        function applyPreset(presetName) {
            // Update active button
            document.querySelectorAll('.preset-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.preset === presetName);
            });

            // Apply preset values
            switch(presetName) {
                case 'clean':
                    document.getElementById('handDrawnEnabled').checked = false;
                    document.getElementById('tremorIntensity').value = 0.0;
                    document.getElementById('weightVariation').value = 0.1;
                    break;
                case 'sketchy':
                    document.getElementById('handDrawnEnabled').checked = true;
                    document.getElementById('tremorIntensity').value = 0.2;
                    document.getElementById('weightVariation').value = 0.3;
                    break;
                case 'artistic':
                    document.getElementById('handDrawnEnabled').checked = true;
                    document.getElementById('tremorIntensity').value = 0.4;
                    document.getElementById('weightVariation').value = 0.5;
                    break;
                case 'expressive':
                    document.getElementById('handDrawnEnabled').checked = true;
                    document.getElementById('tremorIntensity').value = 0.6;
                    document.getElementById('weightVariation').value = 0.7;
                    break;
            }

            // Update value displays
            document.getElementById('tremorValue').textContent = document.getElementById('tremorIntensity').value;
            document.getElementById('weightValue').textContent = document.getElementById('weightVariation').value;

            updateConfiguration();
        }

        // Update configuration object
        function updateConfiguration() {
            const config = new wasm.ConfigBuilder()
                .backend(document.getElementById('backendSelect').value)
                .multipass_enabled(document.getElementById('multipassEnabled').checked)
                .reverse_pass_enabled(document.getElementById('reversePassEnabled').checked)
                .diagonal_pass_enabled(document.getElementById('diagonalPassEnabled').checked)
                .hand_drawn_enabled(document.getElementById('handDrawnEnabled').checked)
                .tremor_intensity(parseFloat(document.getElementById('tremorIntensity').value))
                .weight_variation(parseFloat(document.getElementById('weightVariation').value))
                .tapering_enabled(document.getElementById('taperingEnabled').checked)
                .canny_low_threshold(parseFloat(document.getElementById('cannyLowThreshold').value))
                .canny_high_threshold(parseFloat(document.getElementById('cannyHighThreshold').value))
                .gaussian_blur_sigma(parseFloat(document.getElementById('gaussianBlurSigma').value))
                .max_resolution(parseInt(document.getElementById('maxResolution').value))
                .simd_enabled(document.getElementById('simdEnabled').checked)
                .build();

            currentConfig = config;
        }

        // Process image to SVG
        async function processImage() {
            if (!currentImage || !currentImageData) {
                showError('Please select an image first');
                return;
            }

            try {
                // Update UI for processing
                const processButton = document.getElementById('processButton');
                const progressContainer = document.getElementById('progressContainer');
                const errorMessage = document.getElementById('errorMessage');

                processButton.disabled = true;
                processButton.textContent = '⏳ Processing...';
                progressContainer.style.display = 'block';
                errorMessage.style.display = 'none';

                // Simulate progress updates
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90;
                    
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressText').textContent = 
                        `Processing... ${Math.round(progress)}%`;
                }, 100);

                // Process image
                updateConfiguration();
                const svgResult = await wasm.process_image_to_svg(
                    currentImageData,
                    currentImageWidth,
                    currentImageHeight,
                    currentConfig
                );

                // Complete progress
                clearInterval(progressInterval);
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressText').textContent = 'Complete!';

                // Store result
                currentSVG = svgResult;

                // Display SVG
                const svgContainer = document.getElementById('svgContainer');
                svgContainer.innerHTML = svgResult;

                // Show statistics
                displayStatistics();

                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 1000);

            } catch (error) {
                showError('Processing failed: ' + error.message);
            } finally {
                // Reset UI
                const processButton = document.getElementById('processButton');
                processButton.disabled = false;
                processButton.textContent = '🚀 Process Image to SVG';
            }
        }

        // Display processing statistics
        function displayStatistics() {
            const stats = wasm.get_last_processing_stats();
            const statsContainer = document.getElementById('statsContainer');
            const statsGrid = document.getElementById('statsGrid');

            const statsData = [
                { label: 'Processing Time', value: `${stats.processing_time_ms.toFixed(0)}ms` },
                { label: 'Input Resolution', value: stats.input_resolution },
                { label: 'Output Paths', value: stats.output_paths.toString() },
                { label: 'Backend Used', value: stats.backend_used },
                { label: 'Multi-pass', value: stats.multipass_enabled ? 'Yes' : 'No' },
                { label: 'Hand-drawn', value: stats.hand_drawn_enabled ? 'Yes' : 'No' }
            ];

            statsGrid.innerHTML = statsData.map(stat => `
                <div class="stat-item">
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');

            statsContainer.style.display = 'block';
        }

        // Show error message
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // Export current configuration
        window.exportConfiguration = function() {
            updateConfiguration();
            const configJSON = JSON.stringify(currentConfig, null, 2);
            document.getElementById('configDisplay').textContent = configJSON;
        }

        // Download SVG
        window.downloadSVG = function() {
            if (!currentSVG) {
                showError('No SVG to download');
                return;
            }

            const blob = new Blob([currentSVG], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vec2art-output.svg';
            a.click();
            URL.revokeObjectURL(url);
        }

        // View SVG source
        window.viewSVGSource = function() {
            if (!currentSVG) {
                showError('No SVG source to view');
                return;
            }

            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                    <head><title>SVG Source</title></head>
                    <body>
                        <pre style="font-family: monospace; white-space: pre-wrap; word-wrap: break-word;">
${currentSVG.replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                        </pre>
                    </body>
                </html>
            `);
        }

        // Load sample image
        window.loadSampleImage = function() {
            // Create a sample canvas image
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 300;

            // Draw a sample pattern
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, 400, 300);
            
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // Draw some shapes
            ctx.beginPath();
            ctx.arc(200, 150, 80, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.rect(100, 100, 200, 100);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(50, 50);
            ctx.lineTo(350, 250);
            ctx.moveTo(350, 50);
            ctx.lineTo(50, 250);
            ctx.stroke();

            canvas.toBlob(blob => {
                const file = new File([blob], 'sample-image.png', { type: 'image/png' });
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                document.getElementById('imageInput').files = dataTransfer.files;
                
                const event = new Event('change', { bubbles: true });
                document.getElementById('imageInput').dispatchEvent(event);
            });
        }

        // Reset demo
        window.resetDemo = function() {
            currentImage = null;
            currentImageData = null;
            currentSVG = null;
            
            document.getElementById('imageInput').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('originalImage').style.display = 'none';
            document.getElementById('imagePlaceholder').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('statsContainer').style.display = 'none';
            document.getElementById('svgContainer').innerHTML = '<div class="placeholder">SVG will appear here after processing</div>';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>
</body>
</html>