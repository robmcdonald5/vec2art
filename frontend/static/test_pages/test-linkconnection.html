<!doctype html>
<html>
	<head>
		<title>LinkError Test</title>
		<style>
			body {
				font-family: monospace;
				padding: 20px;
				background: #1a1a1a;
				color: #e0e0e0;
			}
			.pass {
				color: #4caf50;
			}
			.fail {
				color: #f44336;
			}
			.warn {
				color: #ff9800;
			}
			.info {
				color: #2196f3;
			}
			pre {
				background: #333;
				padding: 10px;
				border-radius: 4px;
				overflow-x: auto;
				max-height: 300px;
			}
		</style>
	</head>
	<body>
		<h1>üî¨ WASM LinkError Test</h1>
		<div id="results"></div>

		<script type="module">
			const log = (message, type = 'info') => {
				const timestamp = new Date().toLocaleTimeString();
				const div = document.getElementById('results');
				div.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
				console.log(`[${type.toUpperCase()}] ${message}`);
			};

			async function testWasmLoading() {
				try {
					log('üöÄ Starting WASM LinkError Test', 'info');

					// Test import from static files
					log('Attempting to import WASM module...', 'info');
					const wasmModule = await import('/wasm/vectorize_wasm.js');
					log('‚úì WASM module imported successfully', 'pass');

					// Test initialization
					log('Attempting to initialize WASM...', 'info');
					await wasmModule.default('/wasm/vectorize_wasm_bg.wasm');
					log('‚úì WASM module initialized successfully', 'pass');

					// Test basic function calls
					log('Testing basic function calls...', 'info');

					// Test threading info (should work with stubs)
					try {
						const threadingInfo = wasmModule.get_threading_info();
						log(`‚úì get_threading_info(): ${threadingInfo}`, 'pass');
					} catch (e) {
						log(`‚úó get_threading_info() failed: ${e.message}`, 'fail');
					}

					// Test thread count
					try {
						const threadCount = wasmModule.get_thread_count();
						log(`‚úì get_thread_count(): ${threadCount}`, 'pass');
					} catch (e) {
						log(`‚úó get_thread_count() failed: ${e.message}`, 'fail');
					}

					// Test available backends
					try {
						const backends = wasmModule.get_available_backends();
						log(`‚úì get_available_backends(): ${backends}`, 'pass');
					} catch (e) {
						log(`‚úó get_available_backends() failed: ${e.message}`, 'fail');
					}

					log('üéâ All tests completed successfully! LinkError should be resolved.', 'pass');
				} catch (error) {
					log(`üí• WASM loading failed: ${error.message}`, 'fail');
					log(`Stack trace: ${error.stack}`, 'warn');

					// Check for specific LinkError
					if (error.message.includes('__wbindgen_describe')) {
						log('‚ùå LinkError detected: __wbindgen_describe issue still present', 'fail');
					} else {
						log('‚ÑπÔ∏è Different error type - not a LinkError', 'warn');
					}
				}
			}

			// Start test when page loads
			window.addEventListener('load', testWasmLoading);
		</script>
	</body>
</html>
