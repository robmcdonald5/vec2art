<!doctype html>
<html>
	<head>
		<title>üîç Debug Import Test</title>
		<style>
			body {
				font-family: monospace;
				padding: 20px;
				background: #1a1a1a;
				color: #e0e0e0;
			}
			.pass {
				color: #4caf50;
			}
			.fail {
				color: #f44336;
			}
			.warn {
				color: #ff9800;
			}
		</style>
	</head>
	<body>
		<h1>üîç Debug Import Test</h1>
		<div id="results"></div>

		<script type="module">
			function log(msg, type = 'info') {
				document.getElementById('results').innerHTML +=
					`<div class="${type}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
				console.log(msg);
			}

			async function debugImports() {
				log('üîç Starting import debugging...', 'info');

				try {
					// Test 1: Import placeholder directly
					log('1. Testing placeholder import...', 'info');
					const placeholder = await import('/wasm/__wbindgen_placeholder__.js');
					log('‚úÖ Placeholder imported successfully', 'pass');
					console.log('Placeholder:', placeholder);

					// Test 2: Import main WASM module (NEW: single-threaded architecture)
					log('2. Testing main WASM module import...', 'info');
					const wasmModule = await import('/wasm/vectorize_wasm.js');
					log('‚úÖ WASM module imported successfully!', 'pass');
					console.log('WASM module:', wasmModule);

					// Test 3: Test WASM initialization
					log('3. Testing WASM initialization...', 'info');
					await wasmModule.default('/wasm/vectorize_wasm_bg.wasm');
					log('‚úÖ WASM initialized successfully!', 'pass');

					// Test 4: Test threading functions (should return single-threaded values)
					log('4. Testing threading functions...', 'info');
					if (typeof wasmModule.get_thread_count === 'function') {
						const threadCount = wasmModule.get_thread_count();
						log(`‚úÖ Thread count: ${threadCount} (single-threaded)`, 'pass');
					}
					if (typeof wasmModule.is_threading_supported === 'function') {
						const threadingSupported = wasmModule.is_threading_supported();
						log(`‚úÖ Threading supported: ${threadingSupported} (expected: false)`, 'pass');
					}

					log('üéâ All tests passed! New single-threaded WASM architecture working!', 'pass');
				} catch (error) {
					log(`‚ùå Import failed: ${error.message}`, 'fail');
					console.error('Full error:', error);

					// Try to identify which specific import failed
					if (error.message.includes('__wbindgen_placeholder__')) {
						log('üîç Issue appears to be with placeholder import', 'warn');
					} else if (error.message.includes('vectorize_wasm.js')) {
						log('üîç Issue appears to be with main WASM module import', 'warn');
					} else if (error.message.includes('vectorize_wasm_bg.wasm')) {
						log('üîç Issue appears to be with WASM binary initialization', 'warn');
					} else {
						log('üîç Unknown import issue detected', 'warn');
					}
				}
			}

			window.addEventListener('load', debugImports);
		</script>
	</body>
</html>
