<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Smart Performance Selector Test</title>
		<style>
			body {
				font-family:
					system-ui,
					-apple-system,
					sans-serif;
				max-width: 1000px;
				margin: 0 auto;
				padding: 20px;
				background: #f5f5f5;
			}
			.container {
				background: white;
				border-radius: 8px;
				padding: 20px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
				margin-bottom: 20px;
			}
			h1,
			h2,
			h3 {
				color: #333;
				margin-top: 0;
			}
			.grid {
				display: grid;
				gap: 15px;
			}
			.grid-2 {
				grid-template-columns: repeat(2, 1fr);
			}
			.grid-3 {
				grid-template-columns: repeat(3, 1fr);
			}
			.grid-4 {
				grid-template-columns: repeat(4, 1fr);
			}
			.card {
				padding: 15px;
				border: 2px solid #e0e0e0;
				border-radius: 8px;
				background: white;
				transition: all 0.2s;
			}
			.card:hover {
				border-color: #2196f3;
			}
			.card.selected {
				border-color: #2196f3;
				background: #e3f2fd;
			}
			.card.recommended {
				border-color: #4caf50;
				background: #e8f5e9;
			}
			.metric {
				text-align: center;
				padding: 10px;
				background: #f5f5f5;
				border-radius: 4px;
			}
			.metric .value {
				font-size: 24px;
				font-weight: bold;
				color: #333;
			}
			.metric .label {
				font-size: 12px;
				color: #666;
				margin-top: 5px;
			}
			.status {
				padding: 12px;
				border-radius: 4px;
				margin: 10px 0;
			}
			.status.info {
				background: #e3f2fd;
				color: #1976d2;
			}
			.status.success {
				background: #e8f5e9;
				color: #388e3c;
			}
			.status.warning {
				background: #fff3e0;
				color: #f57c00;
			}
			.status.error {
				background: #ffebee;
				color: #c62828;
			}
			button {
				background: #2196f3;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 14px;
				margin: 5px;
			}
			button:hover:not(:disabled) {
				background: #1976d2;
			}
			button:disabled {
				background: #ccc;
				cursor: not-allowed;
			}
			.icon {
				font-size: 24px;
				margin-bottom: 8px;
			}
			.mode-title {
				font-weight: bold;
				margin-bottom: 4px;
			}
			.mode-details {
				font-size: 12px;
				color: #666;
			}
			.warning {
				color: #f57c00;
				font-size: 12px;
				margin-top: 5px;
			}
			.feature-list {
				font-size: 12px;
				margin-top: 10px;
			}
			.feature-list .supported {
				color: #4caf50;
			}
			.feature-list .unsupported {
				color: #f44336;
			}
			#console {
				background: #263238;
				color: #aed581;
				padding: 15px;
				border-radius: 4px;
				font-family: 'Courier New', monospace;
				font-size: 12px;
				max-height: 300px;
				overflow-y: auto;
				white-space: pre-wrap;
			}
			.console-entry {
				margin: 2px 0;
				padding: 2px 0;
			}
			.console-entry.error {
				color: #ef5350;
			}
			.console-entry.warn {
				color: #ffb74d;
			}
			.console-entry.success {
				color: #66bb6a;
			}
			.badge {
				display: inline-block;
				padding: 2px 6px;
				border-radius: 3px;
				font-size: 10px;
				font-weight: bold;
				margin-left: 5px;
			}
			.badge.recommended {
				background: #4caf50;
				color: white;
			}
			.badge.warning {
				background: #ff9800;
				color: white;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>üß† Smart Performance Selector Test</h1>
			<p>
				This demonstrates the intelligent CPU detection and adaptive performance recommendations.
			</p>

			<div id="detectionStatus" class="status info">Detecting system capabilities...</div>
		</div>

		<div class="container">
			<h2>System Analysis</h2>
			<div id="systemInfo" class="grid-4 grid">
				<div class="metric">
					<div class="value" id="coreCount">?</div>
					<div class="label">CPU Cores</div>
				</div>
				<div class="metric">
					<div class="value" id="performance">?</div>
					<div class="label">Performance Class</div>
				</div>
				<div class="metric">
					<div class="value" id="deviceType">?</div>
					<div class="label">Device Type</div>
				</div>
				<div class="metric">
					<div class="value" id="memory">?</div>
					<div class="label">Est. Memory</div>
				</div>
			</div>

			<div id="capabilities" class="grid-2 grid" style="margin-top: 15px">
				<!-- Capabilities will be populated -->
			</div>
		</div>

		<div class="container">
			<h2>Smart Recommendations</h2>
			<div id="defaultRecommendation">
				<!-- Default recommendation will be shown here -->
			</div>

			<h3>Performance Modes</h3>
			<div id="performanceModes" class="grid-3 grid">
				<!-- Performance modes will be populated -->
			</div>

			<div id="selectionSummary" style="margin-top: 15px">
				<!-- Selection summary will be shown here -->
			</div>

			<button id="testButton" onclick="testSelection()" disabled>
				Test Selected Configuration
			</button>
		</div>

		<div class="container">
			<h2>Adaptive Features Demonstrated</h2>
			<div class="grid-2 grid">
				<div>
					<h4>üîç Intelligent Detection</h4>
					<ul style="font-size: 14px">
						<li>Hardware capability analysis</li>
						<li>Device type classification</li>
						<li>Performance class estimation</li>
						<li>Memory and battery detection</li>
					</ul>
				</div>
				<div>
					<h4>üéØ Smart Recommendations</h4>
					<ul style="font-size: 14px">
						<li>Context-aware suggestions</li>
						<li>Battery life optimization</li>
						<li>Thermal management</li>
						<li>Performance vs efficiency balance</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="container">
			<h2>Console Output</h2>
			<div id="console"></div>
		</div>

		<script type="module">
			// Import our CPU detection library
			import {
				detectCPUCapabilities,
				generatePerformanceRecommendations,
				getDefaultRecommendation
			} from '/src/lib/utils/cpu-detection.js';

			// Console logging
			const consoleDiv = document.getElementById('console');
			const log = (message, type = 'info') => {
				const entry = document.createElement('div');
				entry.className = `console-entry ${type}`;
				entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
				consoleDiv.appendChild(entry);
				consoleDiv.scrollTop = consoleDiv.scrollHeight;
			};

			// Override console methods
			const originalLog = console.log;
			const originalWarn = console.warn;
			const originalError = console.error;

			console.log = (...args) => {
				originalLog(...args);
				log(args.join(' '), 'info');
			};
			console.warn = (...args) => {
				originalWarn(...args);
				log(args.join(' '), 'warn');
			};
			console.error = (...args) => {
				originalError(...args);
				log(args.join(' '), 'error');
			};

			let capabilities = null;
			let recommendations = [];
			let selectedMode = 'balanced';

			// Mode icons and colors
			const modeConfig = {
				battery: { icon: 'üîã', color: '#4caf50' },
				balanced: { icon: '‚ö°', color: '#2196f3' },
				performance: { icon: 'üöÄ', color: '#ff9800' },
				extreme: { icon: 'üíª', color: '#f44336' }
			};

			async function runDetection() {
				try {
					log('Starting comprehensive system analysis...');

					capabilities = await detectCPUCapabilities();
					log('‚úÖ System analysis complete', 'success');
					console.log('Detected capabilities:', capabilities);

					recommendations = generatePerformanceRecommendations(capabilities);
					const defaultRec = getDefaultRecommendation(capabilities);
					selectedMode = defaultRec.mode;

					log(`Generated ${recommendations.length} performance recommendations`, 'success');
					log(
						`Default recommendation: ${defaultRec.mode} mode with ${defaultRec.threadCount} threads`
					);

					updateUI();
				} catch (error) {
					log(`‚ùå Detection failed: ${error.message}`, 'error');
					document.getElementById('detectionStatus').className = 'status error';
					document.getElementById('detectionStatus').textContent =
						`Detection failed: ${error.message}`;
				}
			}

			function updateUI() {
				// Update status
				document.getElementById('detectionStatus').className = 'status success';
				document.getElementById('detectionStatus').textContent =
					'System analysis complete! Smart recommendations generated.';

				// Update system info
				document.getElementById('coreCount').textContent = capabilities.cores;
				document.getElementById('performance').textContent =
					capabilities.estimatedPerformance.toUpperCase();
				document.getElementById('deviceType').textContent = capabilities.deviceType.toUpperCase();
				document.getElementById('memory').textContent = `${capabilities.memoryGB}GB`;

				// Update capabilities
				const capabilitiesDiv = document.getElementById('capabilities');
				capabilitiesDiv.innerHTML = `
                <div class="feature-list">
                    <div><strong>Threading:</strong> <span class="${capabilities.features.threading ? 'supported' : 'unsupported'}">${capabilities.features.threading ? '‚úÖ Supported' : '‚ùå Not Available'}</span></div>
                    <div><strong>SIMD:</strong> <span class="${capabilities.features.simd ? 'supported' : 'unsupported'}">${capabilities.features.simd ? '‚úÖ Available' : '‚ùå Not Available'}</span></div>
                    <div><strong>WebGL:</strong> <span class="${capabilities.features.webgl ? 'supported' : 'unsupported'}">${capabilities.features.webgl ? '‚úÖ Supported' : '‚ùå Not Available'}</span></div>
                    <div><strong>WebGL2:</strong> <span class="${capabilities.features.webgl2 ? 'supported' : 'unsupported'}">${capabilities.features.webgl2 ? '‚úÖ Supported' : '‚ùå Not Available'}</span></div>
                </div>
                <div class="feature-list">
                    <div><strong>Battery:</strong> ${capabilities.batteryStatus === 'unknown' ? 'Unknown' : capabilities.batteryStatus.charAt(0).toUpperCase() + capabilities.batteryStatus.slice(1)}</div>
                    <div><strong>Low-end device:</strong> ${capabilities.isLowEndDevice ? 'Yes' : 'No'}</div>
                    <div><strong>Recommended threads:</strong> ${capabilities.recommendedThreads}</div>
                    <div><strong>Max safe threads:</strong> ${capabilities.maxSafeThreads}</div>
                </div>
            `;

				// Show default recommendation
				const defaultRec = getDefaultRecommendation(capabilities);
				document.getElementById('defaultRecommendation').innerHTML = `
                <div class="status success">
                    <strong>üéØ Recommended for Your System:</strong> 
                    ${modeConfig[defaultRec.mode].icon} ${defaultRec.mode.charAt(0).toUpperCase() + defaultRec.mode.slice(1)} mode 
                    with ${defaultRec.threadCount} threads
                    <div style="margin-top: 5px; font-size: 12px;">
                        ${defaultRec.reasoning.slice(0, 2).join(' ‚Ä¢ ')}
                    </div>
                </div>
            `;

				// Update performance modes
				const modesDiv = document.getElementById('performanceModes');
				modesDiv.innerHTML = recommendations
					.map(
						(rec) => `
                <div class="card ${rec.mode === defaultRec.mode ? 'recommended' : ''} ${rec.mode === selectedMode ? 'selected' : ''}" 
                     onclick="selectMode('${rec.mode}')" style="cursor: pointer;">
                    <div class="icon">${modeConfig[rec.mode].icon}</div>
                    <div class="mode-title">
                        ${rec.mode.charAt(0).toUpperCase() + rec.mode.slice(1)}
                        ${rec.mode === defaultRec.mode ? '<span class="badge recommended">RECOMMENDED</span>' : ''}
                    </div>
                    <div class="mode-details">
                        ${rec.threadCount} threads<br>
                        ~${rec.estimatedProcessingTime}<br>
                        ${rec.cpuUsageEstimate}% CPU
                    </div>
                    <div style="margin-top: 8px; font-size: 11px;">
                        ${rec.reasoning
													.slice(0, 2)
													.map((r) => `‚Ä¢ ${r}`)
													.join('<br>')}
                    </div>
                    ${rec.warnings.length > 0 ? `<div class="warning">‚ö†Ô∏è ${rec.warnings[0]}</div>` : ''}
                </div>
            `
					)
					.join('');

				updateSelectionSummary();
				document.getElementById('testButton').disabled = false;
			}

			function selectMode(mode) {
				selectedMode = mode;
				log(`Selected ${mode} mode`);

				// Update visual selection
				document.querySelectorAll('#performanceModes .card').forEach((card) => {
					card.classList.remove('selected');
				});

				const selectedCard = document.querySelector(
					`#performanceModes .card[onclick="selectMode('${mode}')"]`
				);
				if (selectedCard) {
					selectedCard.classList.add('selected');
				}

				updateSelectionSummary();
			}

			function updateSelectionSummary() {
				const selectedRec = recommendations.find((r) => r.mode === selectedMode);
				if (!selectedRec) return;

				document.getElementById('selectionSummary').innerHTML = `
                <div class="status info">
                    <strong>Current Selection:</strong> ${modeConfig[selectedMode].icon} ${selectedMode.charAt(0).toUpperCase() + selectedMode.slice(1)} mode<br>
                    <strong>Configuration:</strong> ${selectedRec.threadCount} threads, ~${selectedRec.estimatedProcessingTime}, ${selectedRec.cpuUsageEstimate}% CPU<br>
                    ${selectedRec.warnings.length > 0 ? `<strong style="color: #f57c00;">‚ö†Ô∏è Warning:</strong> ${selectedRec.warnings.join(', ')}` : ''}
                </div>
            `;
			}

			window.selectMode = selectMode;

			window.testSelection = function () {
				const selectedRec = recommendations.find((r) => r.mode === selectedMode);
				if (!selectedRec) return;

				log(`üß™ Testing ${selectedMode} mode configuration...`, 'success');
				log(
					`Configuration: ${selectedRec.threadCount} threads, ${selectedRec.cpuUsageEstimate}% CPU usage`
				);
				log(`Expected: ${selectedRec.estimatedProcessingTime} processing time`);

				if (selectedRec.warnings.length > 0) {
					log(`‚ö†Ô∏è Warnings: ${selectedRec.warnings.join(', ')}`, 'warn');
				}

				// Simulate some processing
				let progress = 0;
				const interval = setInterval(() => {
					progress += 10;
					log(`Processing... ${progress}%`);

					if (progress >= 100) {
						clearInterval(interval);
						log(`‚úÖ Test completed successfully!`, 'success');
						log(`Performance mode "${selectedMode}" is working correctly`);
					}
				}, 200);
			};

			// Start detection when page loads
			log('Smart Performance Selector Test initialized');
			log(`Browser info: ${navigator.userAgent}`);
			log(`Hardware concurrency: ${navigator.hardwareConcurrency || 'Unknown'}`);
			log(`Cross-origin isolated: ${window.crossOriginIsolated ? 'Yes' : 'No'}`);
			log(
				`SharedArrayBuffer: ${typeof SharedArrayBuffer !== 'undefined' ? 'Available' : 'Not available'}`
			);

			runDetection();
		</script>
	</body>
</html>
